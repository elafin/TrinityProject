<!doctype html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Logowanie / Rejestracja</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--border:#e5e7eb;--text:#0f172a;--muted:#64748b;--primary:#2563eb;}
    body{font-family:Arial,system-ui; background:var(--bg); margin:0; min-height:100vh; display:grid; place-items:center; color:var(--text);}
    .wrap{width:min(520px,92vw);}
    .card{background:var(--card); padding:26px; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.08);}
    .tabs{display:flex; gap:10px; margin-bottom:14px;}
    .tab{flex:1; padding:10px 12px; border:1px solid var(--border); border-radius:14px; background:#fff; cursor:pointer; font-weight:600;}
    .tab.active{border-color:rgba(37,99,235,.35); box-shadow:0 6px 18px rgba(37,99,235,.12);}
    .panel{display:none;}
    .panel.active{display:block;}
    .row{display:flex; flex-direction:column; gap:6px; margin:12px 0;}
    label{font-size:14px; color:var(--muted);}
    input{padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px;}
    button{width:100%; padding:12px 14px; border:0; border-radius:12px; cursor:pointer; font-weight:700;}
    .btn{background:var(--primary); color:#fff;}
    .msg{margin:10px 0; padding:10px 12px; border-radius:12px; background:#f1f5f9;}
    .err{color:#b91c1c; font-size:13px; margin-top:4px;}
    .switch{margin-top:12px; color:var(--muted); font-size:14px;}
    .link{color:var(--primary); cursor:pointer; text-decoration:none; font-weight:700;}
    .divider{height:1px; background:var(--border); margin:14px 0;}
  </style>
</head>
<body>

<div class="wrap">
  <div class="card">

    <div class="tabs">
      <button type="button" class="tab" id="tab-login" onclick="openTab('login')">Logowanie</button>
      <button type="button" class="tab" id="tab-register" onclick="openTab('register')">Rejestracja</button>
    </div>

    <!-- komunikaty globalne -->
    <div class="msg" th:if="${param.error}">Błędny login lub hasło.</div>
    <div class="msg" th:if="${param.logout}">Wylogowano.</div>
    <div class="msg" th:if="${param.registered}">Konto utworzone. Zaloguj się.</div>

    <!-- LOGIN -->
    <div class="panel" id="panel-login">
      <h2 style="margin:6px 0 4px;">Zaloguj się</h2>
      <p style="margin:0 0 10px;color:var(--muted);">Wpisz login i hasło.</p>

      <form th:action="@{/auth/login}" method="post">
        <div class="row">
          <label>Login</label>
          <input name="username" autocomplete="username" required>
        </div>
        <div class="row">
          <label>Hasło</label>
          <input type="password" name="password" autocomplete="current-password" required>
        </div>
        <button class="btn" type="submit">Zaloguj</button>
      </form>

      <div class="divider"></div>
      <div class="switch">
        Nie masz konta?
        <span class="link" onclick="openTab('register')">Zarejestruj się</span>
      </div>
    </div>

    <!-- REGISTER -->
    <div class="panel" id="panel-register">
      <h2 style="margin:6px 0 4px;">Utwórz konto</h2>
      <p style="margin:0 0 10px;color:var(--muted);">Zarejestruj się w kilka sekund.</p>

      <div class="msg" th:if="${error}" th:text="${error}"></div>

      <form th:action="@{/auth/register}" th:object="${form}" method="post">
        <div class="row">
          <label>Login</label>
          <input th:field="*{login}" required>
          <div class="err" th:if="${#fields.hasErrors('login')}" th:errors="*{login}"></div>
        </div>

        <div class="row">
          <label>Hasło</label>
          <input type="password" th:field="*{password}" required>
          <div class="err" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
        </div>

        <div class="row">
          <label>Powtórz hasło</label>
          <input type="password" th:field="*{confirmPassword}" required>
          <div class="err" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
        </div>

        <button class="btn" type="submit">Zarejestruj</button>
      </form>

      <div class="divider"></div>
      <div class="switch">
        Masz już konto?
        <span class="link" onclick="openTab('login')">Zaloguj się</span>
      </div>
    </div>

  </div>
</div>

<script th:inline="javascript">
  function openTab(which){
    const loginTab = document.getElementById('tab-login');
    const regTab   = document.getElementById('tab-register');
    const loginP   = document.getElementById('panel-login');
    const regP     = document.getElementById('panel-register');

    const isLogin = (which === 'login');

    loginTab.classList.toggle('active', isLogin);
    regTab.classList.toggle('active', !isLogin);
    loginP.classList.toggle('active', isLogin);
    regP.classList.toggle('active', !isLogin);

    // URL bez reload (opcjonalnie)
    try {
      const url = new URL(window.location.href);
      url.searchParams.set('tab', which);
      window.history.replaceState({}, '', url.toString());
    } catch(e) {}
  }

  // Start: z parametru ?tab= albo z modelu "open"
  (function init(){
    const url = new URL(window.location.href);
    const tab = url.searchParams.get('tab');

    // open z backendu (np. po błędach rejestracji)
    const openFromServer = /*[[${open}]]*/ null;

    if (openFromServer === 'register') { openTab('register'); return; }
    if (tab === 'register') { openTab('register'); return; }

    // domyślnie login
    openTab('login');
  })();
</script>

</body>
</html>
